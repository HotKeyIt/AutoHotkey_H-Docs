/* jqTree 0.21.0 | Copyright 2013 Marco Braak */
(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T=[].slice,N={}.hasOwnProperty,C=function(e,t){function r(){this.constructor=e}for(var n in t){if(N.call(t,n))e[n]=t[n]}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e};e=this.jQuery;g=function(){function t(t,n){this.$el=e(t);this.options=e.extend({},this.defaults,n)}t.prototype.defaults={};t.prototype.destroy=function(){return this._deinit()};t.prototype._init=function(){return null};t.prototype._deinit=function(){return null};t.register=function(n,r){var i,s,o,u,a;u=function(){return"simple_widget_"+r};a=function(n,r){var i;i=e.data(n,r);if(i&&i instanceof t){return i}else{return null}};s=function(t,r){var i,s,o,f,l,c;i=u();for(l=0,c=t.length;l<c;l++){s=t[l];o=a(s,i);if(!o){f=new n(s,r);if(!e.data(s,i)){e.data(s,i,f)}f._init()}}return t};o=function(t){var n,r,i,s,o,f;n=u();f=[];for(s=0,o=t.length;s<o;s++){r=t[s];i=a(r,n);if(i){i.destroy()}f.push(e.removeData(r,n))}return f};i=function(n,r,i){var s,o,a,f,l,c;o=null;for(l=0,c=n.length;l<c;l++){s=n[l];a=e.data(s,u());if(a&&a instanceof t){f=a[r];if(f&&typeof f==="function"){o=f.apply(a,i)}}}return o};return e.fn[r]=function(){var e,t,n,r,u;n=arguments[0],t=2<=arguments.length?T.call(arguments,1):[];e=this;if(n===void 0||typeof n==="object"){u=n;return s(e,u)}else if(typeof n==="string"&&n[0]!=="_"){r=n;if(r==="destroy"){return o(e)}else{return i(e,r,t)}}}};return t}();this.SimpleWidget=g;l=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}C(n,t);n.is_mouse_handled=false;n.prototype._init=function(){this.$el.bind("mousedown.mousewidget",e.proxy(this._mouseDown,this));this.$el.bind("touchstart.mousewidget",e.proxy(this._touchStart,this));this.is_mouse_started=false;this.mouse_delay=0;this._mouse_delay_timer=null;this._is_mouse_delay_met=true;return this.mouse_down_info=null};n.prototype._deinit=function(){var t;this.$el.unbind("mousedown.mousewidget");this.$el.unbind("touchstart.mousewidget");t=e(document);t.unbind("mousemove.mousewidget");return t.unbind("mouseup.mousewidget")};n.prototype._mouseDown=function(e){var t;if(e.which!==1){return}t=this._handleMouseDown(e,this._getPositionInfo(e));if(t){e.preventDefault()}return t};n.prototype._handleMouseDown=function(e,t){if(n.is_mouse_handled){return}if(this.is_mouse_started){this._handleMouseUp(t)}this.mouse_down_info=t;if(!this._mouseCapture(t)){return}this._handleStartMouse();this.is_mouse_handled=true;return true};n.prototype._handleStartMouse=function(){var t;t=e(document);t.bind("mousemove.mousewidget",e.proxy(this._mouseMove,this));t.bind("touchmove.mousewidget",e.proxy(this._touchMove,this));t.bind("mouseup.mousewidget",e.proxy(this._mouseUp,this));t.bind("touchend.mousewidget",e.proxy(this._touchEnd,this));if(this.mouse_delay){return this._startMouseDelayTimer()}};n.prototype._startMouseDelayTimer=function(){if(this._mouse_delay_timer){clearTimeout(this._mouse_delay_timer)}this._mouse_delay_timer=setTimeout(function(e){return function(){return e._is_mouse_delay_met=true}}(this),this.mouse_delay);return this._is_mouse_delay_met=false};n.prototype._mouseMove=function(e){return this._handleMouseMove(e,this._getPositionInfo(e))};n.prototype._handleMouseMove=function(e,t){if(this.is_mouse_started){this._mouseDrag(t);return e.preventDefault()}if(this.mouse_delay&&!this._is_mouse_delay_met){return true}this.is_mouse_started=this._mouseStart(this.mouse_down_info)!==false;if(this.is_mouse_started){this._mouseDrag(t)}else{this._handleMouseUp(t)}return!this.is_mouse_started};n.prototype._getPositionInfo=function(e){return{page_x:e.pageX,page_y:e.pageY,target:e.target,original_event:e}};n.prototype._mouseUp=function(e){return this._handleMouseUp(this._getPositionInfo(e))};n.prototype._handleMouseUp=function(t){var n;n=e(document);n.unbind("mousemove.mousewidget");n.unbind("touchmove.mousewidget");n.unbind("mouseup.mousewidget");n.unbind("touchend.mousewidget");if(this.is_mouse_started){this.is_mouse_started=false;this._mouseStop(t)}};n.prototype._mouseCapture=function(e){return true};n.prototype._mouseStart=function(e){return null};n.prototype._mouseDrag=function(e){return null};n.prototype._mouseStop=function(e){return null};n.prototype.setMouseDelay=function(e){return this.mouse_delay=e};n.prototype._touchStart=function(e){var t;if(e.originalEvent.touches.length>1){return}t=e.originalEvent.changedTouches[0];return this._handleMouseDown(e,this._getPositionInfo(t))};n.prototype._touchMove=function(e){var t;if(e.originalEvent.touches.length>1){return}t=e.originalEvent.changedTouches[0];return this._handleMouseMove(e,this._getPositionInfo(t))};n.prototype._touchEnd=function(e){var t;if(e.originalEvent.touches.length>1){return}t=e.originalEvent.changedTouches[0];return this._handleMouseUp(this._getPositionInfo(t))};return n}(g);this.Tree={};e=this.jQuery;p={getName:function(e){return p.strings[e-1]},nameToIndex:function(e){var t,n,r;for(t=n=1,r=p.strings.length;1<=r?n<=r:n>=r;t=1<=r?++n:--n){if(p.strings[t-1]===e){return t}}return 0}};p.BEFORE=1;p.AFTER=2;p.INSIDE=3;p.NONE=4;p.strings=["before","after","inside","none"];this.Tree.Position=p;c=function(){function t(e,n,r){if(n==null){n=false}if(r==null){r=t}this.setData(e);this.children=[];this.parent=null;if(n){this.id_mapping={};this.tree=this;this.node_class=r}}t.prototype.setData=function(e){var t,n,r;if(typeof e!=="object"){return this.name=e}else{r=[];for(t in e){n=e[t];if(t==="label"){r.push(this.name=n)}else{r.push(this[t]=n)}}return r}};t.prototype.initFromData=function(e){var t,n;n=function(e){return function(n){e.setData(n);if(n.children){return t(n.children)}}}(this);t=function(e){return function(t){var n,r,i,s;for(i=0,s=t.length;i<s;i++){n=t[i];r=new e.tree.node_class("");r.initFromData(n);e.addChild(r)}return null}}(this);n(e);return null};t.prototype.loadFromData=function(e){var t,n,r,i;this.removeChildren();for(r=0,i=e.length;r<i;r++){n=e[r];t=new this.tree.node_class(n);this.addChild(t);if(typeof n==="object"&&n.children){t.loadFromData(n.children)}}return null};t.prototype.addChild=function(e){this.children.push(e);return e._setParent(this)};t.prototype.addChildAtPosition=function(e,t){this.children.splice(t,0,e);return e._setParent(this)};t.prototype._setParent=function(e){this.parent=e;this.tree=e.tree;return this.tree.addNodeToIndex(this)};t.prototype.removeChild=function(e){e.removeChildren();return this._removeChild(e)};t.prototype._removeChild=function(e){this.children.splice(this.getChildIndex(e),1);return this.tree.removeNodeFromIndex(e)};t.prototype.getChildIndex=function(t){return e.inArray(t,this.children)};t.prototype.hasChildren=function(){return this.children.length!==0};t.prototype.isFolder=function(){return this.hasChildren()||this.load_on_demand};t.prototype.iterate=function(e){var t;t=function(n){return function(r,i){var s,o,u,a,f;if(r.children){f=r.children;for(u=0,a=f.length;u<a;u++){s=f[u];o=e(s,i);if(n.hasChildren()&&o){t(s,i+1)}}return null}}}(this);t(this,0);return null};t.prototype.moveNode=function(e,t,n){if(e.isParentOf(t)){return}e.parent._removeChild(e);if(n===p.AFTER){return t.parent.addChildAtPosition(e,t.parent.getChildIndex(t)+1)}else if(n===p.BEFORE){return t.parent.addChildAtPosition(e,t.parent.getChildIndex(t))}else if(n===p.INSIDE){return t.addChildAtPosition(e,0)}};t.prototype.getData=function(){var e;e=function(t){return function(t){var n,r,i,s,o,u,a;n=[];for(u=0,a=t.length;u<a;u++){i=t[u];s={};for(r in i){o=i[r];if(r!=="parent"&&r!=="children"&&r!=="element"&&r!=="tree"&&Object.prototype.hasOwnProperty.call(i,r)){s[r]=o}}if(i.hasChildren()){s.children=e(i.children)}n.push(s)}return n}}(this);return e(this.children)};t.prototype.getNodeByName=function(e){var t;t=null;this.iterate(function(n){if(n.name===e){t=n;return false}else{return true}});return t};t.prototype.addAfter=function(e){var t,n;if(!this.parent){return null}else{n=new this.tree.node_class(e);t=this.parent.getChildIndex(this);this.parent.addChildAtPosition(n,t+1);return n}};t.prototype.addBefore=function(e){var t,n;if(!this.parent){return null}else{n=new this.tree.node_class(e);t=this.parent.getChildIndex(this);this.parent.addChildAtPosition(n,t);return n}};t.prototype.addParent=function(e){var t,n,r,i,s,o;if(!this.parent){return null}else{n=new this.tree.node_class(e);n._setParent(this.tree);r=this.parent;o=r.children;for(i=0,s=o.length;i<s;i++){t=o[i];n.addChild(t)}r.children=[];r.addChild(n);return n}};t.prototype.remove=function(){if(this.parent){this.parent.removeChild(this);return this.parent=null}};t.prototype.append=function(e){var t;t=new this.tree.node_class(e);this.addChild(t);return t};t.prototype.prepend=function(e){var t;t=new this.tree.node_class(e);this.addChildAtPosition(t,0);return t};t.prototype.isParentOf=function(e){var t;t=e.parent;while(t){if(t===this){return true}t=t.parent}return false};t.prototype.getLevel=function(){var e,t;e=0;t=this;while(t.parent){e+=1;t=t.parent}return e};t.prototype.getNodeById=function(e){return this.id_mapping[e]};t.prototype.addNodeToIndex=function(e){if(e.id!=null){return this.id_mapping[e.id]=e}};t.prototype.removeNodeFromIndex=function(e){if(e.id!=null){return delete this.id_mapping[e.id]}};t.prototype.removeChildren=function(){this.iterate(function(e){return function(t){e.tree.removeNodeFromIndex(t);return true}}(this));return this.children=[]};t.prototype.getPreviousSibling=function(){var e;if(!this.parent){return null}else{e=this.parent.getChildIndex(this)-1;if(e>=0){return this.parent.children[e]}else{return null}}};t.prototype.getNextSibling=function(){var e;if(!this.parent){return null}else{e=this.parent.getChildIndex(this)+1;if(e<this.parent.children.length){return this.parent.children[e]}else{return null}}};t.prototype.getNodesByProperty=function(e,t){return this.filter(function(n){return n[e]===t})};t.prototype.filter=function(e){var t;t=[];this.iterate(function(n){if(e(n)){t.push(n)}return true});return t};return t}();this.Tree.Node=c;i=function(){function t(e){this.tree_widget=e;this.opened_icon_element=this.createButtonElement(e.options.openedIcon);this.closed_icon_element=this.createButtonElement(e.options.closedIcon)}t.prototype.render=function(e){if(e&&e.parent){return this.renderFromNode(e)}else{return this.renderFromRoot()}};t.prototype.renderNode=function(t){var n,r,i;e(t.element).remove();r=new h(t.parent,this.tree_widget);n=this.createLi(t);this.attachNodeData(t,n);i=t.getPreviousSibling();if(i){e(i.element).after(n)}else{r.getUl().prepend(n)}if(t.children){return this.renderFromNode(t)}};t.prototype.renderFromRoot=function(){var e;e=this.tree_widget.element;e.empty();return this.createDomElements(e[0],this.tree_widget.tree.children,true,true)};t.prototype.renderFromNode=function(e){var t;t=this.tree_widget._getNodeElementForNode(e);t.getUl().remove();return this.createDomElements(t.$element[0],e.children,false,false)};t.prototype.createDomElements=function(e,t,n,r){var i,s,o,u,a;o=this.createUl(n);e.appendChild(o);for(u=0,a=t.length;u<a;u++){i=t[u];s=this.createLi(i);o.appendChild(s);this.attachNodeData(i,s);if(i.hasChildren()){this.createDomElements(s,i.children,false,i.is_open)}}return null};t.prototype.attachNodeData=function(t,n){t.element=n;return e(n).data("node",t)};t.prototype.createUl=function(e){var t,n;if(e){t="jqtree-tree"}else{t=""}n=document.createElement("ul");n.className="jqtree_common "+t;return n};t.prototype.createLi=function(t){var n;if(t.isFolder()){n=this.createFolderLi(t)}else{n=this.createNodeLi(t)}if(this.tree_widget.options.onCreateLi){this.tree_widget.options.onCreateLi(t,e(n))}return n};t.prototype.createFolderLi=function(e){var t,n,r,i,s,o,u,a;t=this.getButtonClasses(e);s=this.getFolderClasses(e);i=this.escapeIfNecessary(e.name);if(e.is_open){o=this.opened_icon_element}else{o=this.closed_icon_element}u=document.createElement("li");u.className="jqtree_common "+s;r=document.createElement("div");r.className="jqtree-element jqtree_common";u.appendChild(r);n=document.createElement("a");n.className="jqtree_common "+t;n.appendChild(o.cloneNode());r.appendChild(n);a=document.createElement("span");a.className="jqtree_common jqtree-title jqtree-title-folder";r.appendChild(a);a.innerHTML=i;return u};t.prototype.createNodeLi=function(e){var t,n,r,i,s,o;s=["jqtree_common"];if(this.tree_widget.select_node_handler&&this.tree_widget.select_node_handler.isNodeSelected(e)){s.push("jqtree-selected")}t=s.join(" ");r=this.escapeIfNecessary(e.name);i=document.createElement("li");i.className=t;n=document.createElement("div");n.className="jqtree-element jqtree_common";i.appendChild(n);o=document.createElement("span");o.className="jqtree-title jqtree_common";o.innerHTML=r;n.appendChild(o);return i};t.prototype.getButtonClasses=function(e){var t;t=["jqtree-toggler"];if(!e.is_open){t.push("jqtree-closed")}return t.join(" ")};t.prototype.getFolderClasses=function(e){var t;t=["jqtree-folder"];if(!e.is_open){t.push("jqtree-closed")}if(this.tree_widget.select_node_handler&&this.tree_widget.select_node_handler.isNodeSelected(e)){t.push("jqtree-selected")}return t.join(" ")};t.prototype.escapeIfNecessary=function(e){if(this.tree_widget.options.autoEscape){return w(e)}else{return e}};t.prototype.createButtonElement=function(t){var n;if(typeof t==="string"){n=document.createElement("div");n.innerHTML=t;return document.createTextNode(n.innerHTML)}else{return e(t)[0]}};return t}();a=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}C(r,t);r.prototype.defaults={autoOpen:false,saveState:false,dragAndDrop:false,selectable:true,useContextMenu:true,onCanSelectNode:null,onSetStateFromStorage:null,onGetStateFromStorage:null,onCreateLi:null,onIsMoveHandle:null,onCanMove:null,onCanMoveTo:null,onLoadFailed:null,autoEscape:true,dataUrl:null,closedIcon:"&#x25ba;",openedIcon:"&#x25bc;",slide:true,nodeClass:c,dataFilter:null,keyboardSupport:true,openFolderDelay:500};r.prototype.toggle=function(e,t){if(t==null){t=true}if(e.is_open){return this.closeNode(e,t)}else{return this.openNode(e,t)}};r.prototype.getTree=function(){return this.tree};r.prototype.selectNode=function(e){return this._selectNode(e,false)};r.prototype._selectNode=function(e,t){var n,r,i,s;if(t==null){t=false}if(!this.select_node_handler){return}n=function(t){return function(){if(t.options.onCanSelectNode){return t.options.selectable&&t.options.onCanSelectNode(e)}else{return t.options.selectable}}}(this);i=function(t){return function(){var n;n=e.parent;if(n&&n.parent&&!n.is_open){return t.openNode(n,false)}}}(this);s=function(e){return function(){if(e.options.saveState){return e.save_state_handler.saveState()}}}(this);if(!e){this._deselectCurrentNode();s();return}if(!n()){return}if(this.select_node_handler.isNodeSelected(e)){if(t){this._deselectCurrentNode();this._triggerEvent("tree.select",{node:null,previous_node:e})}}else{r=this.getSelectedNode();this._deselectCurrentNode();this.addToSelection(e);this._triggerEvent("tree.select",{node:e,deselected_node:r});i()}return s()};r.prototype.getSelectedNode=function(){return this.select_node_handler.getSelectedNode()};r.prototype.toJson=function(){return JSON.stringify(this.tree.getData())};r.prototype.loadData=function(e,t){return this._loadData(e,t)};r.prototype.loadDataFromUrl=function(t,n,r){if(e.type(t)!=="string"){r=n;n=t;t=null}return this._loadDataFromUrl(t,n,r)};r.prototype.reload=function(){return this.loadDataFromUrl()};r.prototype._loadDataFromUrl=function(t,n,r){var i,o,u,a,f,l;i=null;o=function(e){return function(){var t;if(!n){i=e.element}else{t=new s(n,e);i=t.getLi()}return i.addClass("jqtree-loading")}}(this);l=function(e){return function(){if(i){return i.removeClass("jqtree-loading")}}}(this);f=function(n){return function(){if(e.type(t)==="string"){t={url:t}}if(!t.method){return t.method="get"}}}(this);u=function(t){return function(i){l();t._loadData(i,n);if(r&&e.isFunction(r)){return r()}}}(this);a=function(n){return function(){f();return e.ajax({url:t.url,data:t.data,type:t.method.toUpperCase(),cache:false,dataType:"json",success:function(t){var r;if(e.isArray(t)||typeof t==="object"){r=t}else{r=e.parseJSON(t)}if(n.options.dataFilter){r=n.options.dataFilter(r)}return u(r)},error:function(e){l();if(n.options.onLoadFailed){return n.options.onLoadFailed(e)}}})}}(this);if(!t){t=this._getDataUrlInfo(n)}o();if(t===false||t===null){l()}else if(e.isArray(t)){u(t)}else{return a()}};r.prototype._loadData=function(e,t){var n,r,i,s;if(!e){return}this._triggerEvent("tree.load_data",{tree_data:e});if(!t){this._initTree(e)}else{r=this.select_node_handler.getSelectedNodesUnder(t);for(i=0,s=r.length;i<s;i++){n=r[i];this.select_node_handler.removeFromSelection(n)}t.loadFromData(e);t.load_on_demand=false;this._refreshElements(t.parent)}if(this.isDragging()){return this.dnd_handler.refresh()}};r.prototype.getNodeById=function(e){return this.tree.getNodeById(e)};r.prototype.getNodeByName=function(e){return this.tree.getNodeByName(e)};r.prototype.openNode=function(e,t){if(t==null){t=true}return this._openNode(e,t)};r.prototype._openNode=function(e,t,n){var r,i;if(t==null){t=true}r=function(e){return function(t,n,r){var i;i=new s(t,e);return i.open(r,n)}}(this);if(e.isFolder()){if(e.load_on_demand){return this._loadFolderOnDemand(e,t,n)}else{i=e.parent;while(i&&!i.is_open){if(i.parent){r(i,false,null)}i=i.parent}r(e,t,n);return this._saveState()}}};r.prototype._loadFolderOnDemand=function(e,t,n){if(t==null){t=true}return this._loadDataFromUrl(null,e,function(r){return function(){return r._openNode(e,t,n)}}(this))};r.prototype.closeNode=function(e,t){if(t==null){t=true}if(e.isFolder()){(new s(e,this)).close(t);return this._saveState()}};r.prototype.isDragging=function(){if(this.dnd_handler){return this.dnd_handler.is_dragging}else{return false}};r.prototype.refreshHitAreas=function(){return this.dnd_handler.refresh()};r.prototype.addNodeAfter=function(e,t){var n;n=t.addAfter(e);this._refreshElements(t.parent);return n};r.prototype.addNodeBefore=function(e,t){var n;n=t.addBefore(e);this._refreshElements(t.parent);return n};r.prototype.addParentNode=function(e,t){var n;n=t.addParent(e);this._refreshElements(n.parent);return n};r.prototype.removeNode=function(e){var t;t=e.parent;if(t){this.select_node_handler.removeFromSelection(e,true);e.remove();return this._refreshElements(t.parent)}};r.prototype.appendNode=function(e,t){var n,r;if(!t){t=this.tree}n=t.isFolder();r=t.append(e);if(n){this._refreshElements(t)}else{this._refreshElements(t.parent)}return r};r.prototype.prependNode=function(e,t){var n;if(!t){t=this.tree}n=t.prepend(e);this._refreshElements(t);return n};r.prototype.updateNode=function(e,t){var n;n=t.id&&t.id!==e.id;if(n){this.tree.removeNodeFromIndex(e)}e.setData(t);if(n){this.tree.addNodeToIndex(e)}this.renderer.renderNode(e);return this._selectCurrentNode()};r.prototype.moveNode=function(e,t,n){var r;r=p.nameToIndex(n);this.tree.moveNode(e,t,r);return this._refreshElements()};r.prototype.getStateFromStorage=function(){return this.save_state_handler.getStateFromStorage()};r.prototype.addToSelection=function(e){if(e){this.select_node_handler.addToSelection(e);this._getNodeElementForNode(e).select();return this._saveState()}};r.prototype.getSelectedNodes=function(){return this.select_node_handler.getSelectedNodes()};r.prototype.isNodeSelected=function(e){return this.select_node_handler.isNodeSelected(e)};r.prototype.removeFromSelection=function(e){this.select_node_handler.removeFromSelection(e);this._getNodeElementForNode(e).deselect();return this._saveState()};r.prototype.scrollToNode=function(t){var n,r;n=e(t.element);r=n.offset().top-this.$el.offset().top;return this.scroll_handler.scrollTo(r)};r.prototype.getState=function(){return this.save_state_handler.getState()};r.prototype.setState=function(e){this.save_state_handler.setState(e);return this._refreshElements()};r.prototype.setOption=function(e,t){return this.options[e]=t};r.prototype._init=function(){r.__super__._init.call(this);this.element=this.$el;this.mouse_delay=300;this.is_initialized=false;this.renderer=new i(this);if(typeof d!=="undefined"&&d!==null){this.save_state_handler=new d(this)}else{this.options.saveState=false}if(typeof m!=="undefined"&&m!==null){this.select_node_handler=new m(this)}if(typeof n!=="undefined"&&n!==null){this.dnd_handler=new n(this)}else{this.options.dragAndDrop=false}if(typeof v!=="undefined"&&v!==null){this.scroll_handler=new v(this)}if(typeof f!=="undefined"&&f!==null&&typeof m!=="undefined"&&m!==null){this.key_handler=new f(this)}this._initData();this.element.click(e.proxy(this._click,this));this.element.dblclick(e.proxy(this._dblclick,this));if(this.options.useContextMenu){return this.element.bind("contextmenu",e.proxy(this._contextmenu,this))}};r.prototype._deinit=function(){this.element.empty();this.element.unbind();this.key_handler.deinit();this.tree=null;return r.__super__._deinit.call(this)};r.prototype._initData=function(){if(this.options.data){return this._loadData(this.options.data)}else{return this._loadDataFromUrl(this._getDataUrlInfo())}};r.prototype._getDataUrlInfo=function(t){var n,r;n=this.options.dataUrl||this.element.data("url");r=function(e){return function(){var r,i,s;s={url:n};if(t&&t.id){r={node:t.id};s["data"]=r}else{i=e._getNodeIdToBeSelected();if(i){r={selected_node:i};s["data"]=r}}return s}}(this);if(e.isFunction(n)){return n(t)}else if(e.type(n)==="string"){return r()}else{return n}};r.prototype._getNodeIdToBeSelected=function(){if(this.options.saveState){return this.save_state_handler.getNodeIdToBeSelected()}else{return null}};r.prototype._initTree=function(e){this.tree=new this.options.nodeClass(null,true,this.options.nodeClass);if(this.select_node_handler){this.select_node_handler.clear()}this.tree.loadFromData(e);this._openNodes();this._refreshElements();if(!this.is_initialized){this.is_initialized=true;return this._triggerEvent("tree.init")}};r.prototype._openNodes=function(){var e;if(this.options.saveState){if(this.save_state_handler.restoreState()){return}}if(this.options.autoOpen===false){return}else if(this.options.autoOpen===true){e=-1}else{e=parseInt(this.options.autoOpen)}return this.tree.iterate(function(t,n){if(t.hasChildren()){t.is_open=true}return n!==e})};r.prototype._refreshElements=function(e){if(e==null){e=null}this.renderer.render(e);return this._triggerEvent("tree.refresh")};r.prototype._click=function(e){var t,n,r;t=this._getClickTarget(e.target);if(t){if(t.type==="button"){this.toggle(t.node,this.options.slide);e.preventDefault();return e.stopPropagation()}else if(t.type==="label"){r=t.node;n=this._triggerEvent("tree.click",{node:r,click_event:e});if(!n.isDefaultPrevented()){return this._selectNode(r,true)}}}};r.prototype._dblclick=function(e){var t;t=this._getClickTarget(e.target);if(t&&t.type==="label"){return this._triggerEvent("tree.dblclick",{node:t.node,click_event:e})}};r.prototype._getClickTarget=function(t){var n,r,i,s;i=e(t);n=i.closest(".jqtree-toggler");if(n.length){s=this._getNode(n);if(s){return{type:"button",node:s}}}else{r=i.closest(".jqtree-element");if(r.length){s=this._getNode(r);if(s){return{type:"label",node:s}}}}return null};r.prototype._getNode=function(e){var t;t=e.closest("li.jqtree_common");if(t.length===0){return null}else{return t.data("node")}};r.prototype._getNodeElementForNode=function(e){if(e.isFolder()){return new s(e,this)}else{return new h(e,this)}};r.prototype._getNodeElement=function(e){var t;t=this._getNode(e);if(t){return this._getNodeElementForNode(t)}else{return null}};r.prototype._contextmenu=function(t){var n,r;n=e(t.target).closest("ul.jqtree-tree .jqtree-element");if(n.length){r=this._getNode(n);if(r){t.preventDefault();t.stopPropagation();this._triggerEvent("tree.contextmenu",{node:r,click_event:t});return false}}};r.prototype._saveState=function(){if(this.options.saveState){return this.save_state_handler.saveState()}};r.prototype._mouseCapture=function(e){if(this.options.dragAndDrop){return this.dnd_handler.mouseCapture(e)}else{return false}};r.prototype._mouseStart=function(e){if(this.options.dragAndDrop){return this.dnd_handler.mouseStart(e)}else{return false}};r.prototype._mouseDrag=function(e){var t;if(this.options.dragAndDrop){t=this.dnd_handler.mouseDrag(e);if(this.scroll_handler){this.scroll_handler.checkScrolling()}return t}else{return false}};r.prototype._mouseStop=function(e){if(this.options.dragAndDrop){return this.dnd_handler.mouseStop(e)}else{return false}};r.prototype._triggerEvent=function(t,n){var r;r=e.Event(t);e.extend(r,n);this.element.trigger(r);return r};r.prototype.testGenerateHitAreas=function(e){this.dnd_handler.current_item=this._getNodeElementForNode(e);this.dnd_handler.generateHitAreas();return this.dnd_handler.hit_areas};r.prototype._selectCurrentNode=function(){var e,t;e=this.getSelectedNode();if(e){t=this._getNodeElementForNode(e);if(t){return t.select()}}};r.prototype._deselectCurrentNode=function(){var e;e=this.getSelectedNode();if(e){return this.removeFromSelection(e)}};return r}(l);g.register(a,"tree");h=function(){function n(e,t){this.init(e,t)}n.prototype.init=function(t,n){this.node=t;this.tree_widget=n;if(!t.element){t.element=this.tree_widget.element}return this.$element=e(t.element)};n.prototype.getUl=function(){return this.$element.children("ul:first")};n.prototype.getSpan=function(){return this.$element.children(".jqtree-element").find("span.jqtree-title")};n.prototype.getLi=function(){return this.$element};n.prototype.addDropHint=function(e){if(e===p.INSIDE){return new t(this.$element)}else{return new o(this.node,this.$element,e)}};n.prototype.select=function(){return this.getLi().addClass("jqtree-selected")};n.prototype.deselect=function(){return this.getLi().removeClass("jqtree-selected")};return n}();s=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}C(n,e);n.prototype.open=function(e,t){var n,r;if(t==null){t=true}if(!this.node.is_open){this.node.is_open=true;n=this.getButton();n.removeClass("jqtree-closed");n.html("");n.append(this.tree_widget.renderer.opened_icon_element.cloneNode());r=function(t){return function(){t.getLi().removeClass("jqtree-closed");if(e){e()}return t.tree_widget._triggerEvent("tree.open",{node:t.node})}}(this);if(t){return this.getUl().slideDown("fast",r)}else{this.getUl().show();return r()}}};n.prototype.close=function(e){var t,n;if(e==null){e=true}if(this.node.is_open){this.node.is_open=false;t=this.getButton();t.addClass("jqtree-closed");t.html("");t.append(this.tree_widget.renderer.closed_icon_element.cloneNode());n=function(e){return function(){e.getLi().addClass("jqtree-closed");return e.tree_widget._triggerEvent("tree.close",{node:e.node})}}(this);if(e){return this.getUl().slideUp("fast",n)}else{this.getUl().hide();return n()}}};n.prototype.getButton=function(){return this.$element.children(".jqtree-element").find("a.jqtree-toggler")};n.prototype.addDropHint=function(e){if(!this.node.is_open&&e===p.INSIDE){return new t(this.$element)}else{return new o(this.node,this.$element,e)}};return n}(h);w=function(e){return(""+e).replace(/&/g,"&").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};x=function(e,t){var n,r,i,s;for(n=i=0,s=e.length;i<s;n=++i){r=e[n];if(r===t){return n}}return-1};E=function(e,t){if(e.indexOf){return e.indexOf(t)}else{return x(e,t)}};this.Tree.indexOf=E;this.Tree._indexOf=x;S=function(e){return typeof e==="number"&&e%1===0};b=function(){var e,t,n,r,i;e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;t={"\b":"\\b"," ":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};n=function(n){e.lastIndex=0;if(e.test(n)){return'"'+n.replace(e,function(e){var n;n=t[e];return typeof n==="string"?n:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"'}else{return'"'+n+'"'}};r=function(e,t){var i,s,o,u,a,f,l;a=t[e];switch(typeof a){case"string":return n(a);case"number":if(isFinite(a)){return String(a)}else{return"null"};case"boolean":case"null":return String(a);case"object":if(!a){return"null"}o=[];if(Object.prototype.toString.apply(a)==="[object Array]"){for(i=f=0,l=a.length;f<l;i=++f){u=a[i];o[i]=r(i,a)||"null"}return o.length===0?"[]":"["+o.join(",")+"]"}for(s in a){if(Object.prototype.hasOwnProperty.call(a,s)){u=r(s,a);if(u){o.push(n(s)+":"+u)}}}return o.length===0?"{}":"{"+o.join(",")+"}"}};i=function(e){return r("",{"":e})};return i};this.Tree.get_json_stringify_function=b;if(!(this.JSON!=null&&this.JSON.stringify!=null&&typeof this.JSON.stringify==="function")){if(this.JSON==null){this.JSON={}}this.JSON.stringify=b()}d=function(){function t(e){this.tree_widget=e}t.prototype.saveState=function(){var t;t=JSON.stringify(this.getState());if(this.tree_widget.options.onSetStateFromStorage){return this.tree_widget.options.onSetStateFromStorage(t)}else if(this.supportsLocalStorage()){return localStorage.setItem(this.getCookieName(),t)}else if(e.cookie){e.cookie.raw=true;return e.cookie(this.getCookieName(),t,{path:"/"})}};t.prototype.restoreState=function(){var t;t=this.getStateFromStorage();if(t){this.setState(e.parseJSON(t));return true}else{return false}};t.prototype.getStateFromStorage=function(){if(this.tree_widget.options.onGetStateFromStorage){return this.tree_widget.options.onGetStateFromStorage()}else if(this.supportsLocalStorage()){return localStorage.getItem(this.getCookieName())}else if(e.cookie){e.cookie.raw=true;return e.cookie(this.getCookieName())}else{return null}};t.prototype.getState=function(){var e,t;e=function(e){return function(){var t;t=[];e.tree_widget.tree.iterate(function(e){if(e.is_open&&e.id&&e.hasChildren()){t.push(e.id)}return true});return t}}(this);t=function(e){return function(){var t;return function(){var e,n,r,i;r=this.tree_widget.getSelectedNodes();i=[];for(e=0,n=r.length;e<n;e++){t=r[e];i.push(t.id)}return i}.call(e)}}(this);return{open_nodes:e(),selected_node:t()}};t.prototype.setState=function(e){var t,n,r,i,s,o,u;if(e){n=e.open_nodes;i=e.selected_node;if(S(i)){i=[i]}this.tree_widget.tree.iterate(function(e){return function(e){e.is_open=e.id&&e.hasChildren()&&E(n,e.id)>=0;return true}}(this));if(i&&this.tree_widget.select_node_handler){this.tree_widget.select_node_handler.clear();u=[];for(s=0,o=i.length;s<o;s++){t=i[s];r=this.tree_widget.getNodeById(t);if(r){u.push(this.tree_widget.select_node_handler.addToSelection(r))}else{u.push(void 0)}}return u}}};t.prototype.getCookieName=function(){if(typeof this.tree_widget.options.saveState==="string"){return this.tree_widget.options.saveState}else{return"tree"}};t.prototype.supportsLocalStorage=function(){var e;e=function(){var e,t;if(typeof localStorage==="undefined"||localStorage===null){return false}else{try{t="_storage_test";sessionStorage.setItem(t,true);sessionStorage.removeItem(t)}catch(n){e=n;return false}return true}};if(this._supportsLocalStorage==null){this._supportsLocalStorage=e()}return this._supportsLocalStorage};t.prototype.getNodeIdToBeSelected=function(){var t,n;n=this.getStateFromStorage();if(n){t=e.parseJSON(n);return t.selected_node}else{return null}};return t}();m=function(){function e(e){this.tree_widget=e;this.clear()}e.prototype.getSelectedNode=function(){var e;e=this.getSelectedNodes();if(e.length){return e[0]}else{return false}};e.prototype.getSelectedNodes=function(){var e,t,n;if(this.selected_single_node){return[this.selected_single_node]}else{n=[];for(e in this.selected_nodes){t=this.tree_widget.getNodeById(e);if(t){n.push(t)}}return n}};e.prototype.getSelectedNodesUnder=function(e){var t,n,r;if(this.selected_single_node){if(e.isParentOf(this.selected_single_node)){return[this.selected_single_node]}else{return[]}}else{r=[];for(t in this.selected_nodes){n=this.tree_widget.getNodeById(t);if(n&&e.isParentOf(n)){r.push(n)}}return r}};e.prototype.isNodeSelected=function(e){if(e.id){return this.selected_nodes[e.id]}else if(this.selected_single_node){return this.selected_single_node.element===e.element}else{return false}};e.prototype.clear=function(){this.selected_nodes={};return this.selected_single_node=null};e.prototype.removeFromSelection=function(e,t){if(t==null){t=false}if(!e.id){if(this.selected_single_node&&e.element===this.selected_single_node.element){return this.selected_single_node=null}}else{delete this.selected_nodes[e.id];if(t){return e.iterate(function(t){return function(n){delete t.selected_nodes[e.id];return true}}(this))}}};e.prototype.addToSelection=function(e){if(e.id){return this.selected_nodes[e.id]=true}else{return this.selected_single_node=e}};return e}();n=function(){function t(e){this.tree_widget=e;this.hovered_area=null;this.$ghost=null;this.hit_areas=[];this.is_dragging=false;this.current_item=null}t.prototype.mouseCapture=function(t){var n,r;n=e(t.target);if(!this.mustCaptureElement(n)){return null}if(this.tree_widget.options.onIsMoveHandle&&!this.tree_widget.options.onIsMoveHandle(n)){return null}r=this.tree_widget._getNodeElement(n);if(r&&this.tree_widget.options.onCanMove){if(!this.tree_widget.options.onCanMove(r.node)){r=null}}this.current_item=r;return this.current_item!==null};t.prototype.mouseStart=function(t){var n;this.refresh();n=e(t.target).offset();this.drag_element=new r(this.current_item.node,t.page_x-n.left,t.page_y-n.top,this.tree_widget.element);this.is_dragging=true;this.current_item.$element.addClass("jqtree-moving");return true};t.prototype.mouseDrag=function(e){var t,n;this.drag_element.move(e.page_x,e.page_y);t=this.findHoveredArea(e.page_x,e.page_y);n=this.canMoveToArea(t);if(n&&t){if(this.hovered_area!==t){this.hovered_area=t;if(this.mustOpenFolderTimer(t)){this.startOpenFolderTimer(t.node)}this.updateDropHint()}}else{this.removeHover();this.removeDropHint();this.stopOpenFolderTimer()}return true};t.prototype.mustCaptureElement=function(e){return!e.is("input,select")};t.prototype.canMoveToArea=function(e){var t;if(!e){return false}else if(this.tree_widget.options.onCanMoveTo){t=p.getName(e.position);return this.tree_widget.options.onCanMoveTo(this.current_item.node,e.node,t)}else{return true}};t.prototype.mouseStop=function(e){this.moveItem(e);this.clear();this.removeHover();this.removeDropHint();this.removeHitAreas();if(this.current_item){this.current_item.$element.removeClass("jqtree-moving");this.current_item=null}this.is_dragging=false;return false};t.prototype.refresh=function(){this.removeHitAreas();this.generateHitAreas();if(this.current_item){this.current_item=this.tree_widget._getNodeElementForNode(this.current_item.node);if(this.is_dragging){return this.current_item.$element.addClass("jqtree-moving")}}};t.prototype.removeHitAreas=function(){return this.hit_areas=[]};t.prototype.clear=function(){this.drag_element.remove();return this.drag_element=null};t.prototype.removeDropHint=function(){if(this.previous_ghost){return this.previous_ghost.remove()}};t.prototype.removeHover=function(){return this.hovered_area=null};t.prototype.generateHitAreas=function(){var e;e=new u(this.tree_widget.tree,this.current_item.node,this.getTreeDimensions().bottom);return this.hit_areas=e.generate()};t.prototype.findHoveredArea=function(e,t){var n,r,i,s,o;r=this.getTreeDimensions();if(e<r.left||t<r.top||e>r.right||t>r.bottom){return null}s=0;i=this.hit_areas.length;while(s<i){o=s+i>>1;n=this.hit_areas[o];if(t<n.top){i=o}else if(t>n.bottom){s=o+1}else{return n}}return null};t.prototype.mustOpenFolderTimer=function(e){var t;t=e.node;return t.isFolder()&&!t.is_open&&e.position===p.INSIDE};t.prototype.updateDropHint=function(){var e;if(!this.hovered_area){return}this.removeDropHint();e=this.tree_widget._getNodeElementForNode(this.hovered_area.node);return this.previous_ghost=e.addDropHint(this.hovered_area.position)};t.prototype.startOpenFolderTimer=function(e){var t;t=function(t){return function(){return t.tree_widget._openNode(e,t.tree_widget.options.slide,function(){t.refresh();return t.updateDropHint()})}}(this);this.stopOpenFolderTimer();return this.open_folder_timer=setTimeout(t,this.tree_widget.options.openFolderDelay)};t.prototype.stopOpenFolderTimer=function(){if(this.open_folder_timer){clearTimeout(this.open_folder_timer);return this.open_folder_timer=null}};t.prototype.moveItem=function(e){var t,n,r,i,s,o;if(this.hovered_area&&this.hovered_area.position!==p.NONE&&this.canMoveToArea(this.hovered_area)){r=this.current_item.node;o=this.hovered_area.node;i=this.hovered_area.position;s=r.parent;if(i===p.INSIDE){this.hovered_area.node.is_open=true}t=function(e){return function(){e.tree_widget.tree.moveNode(r,o,i);e.tree_widget.element.empty();return e.tree_widget._refreshElements()}}(this);n=this.tree_widget._triggerEvent("tree.move",{move_info:{moved_node:r,target_node:o,position:p.getName(i),previous_parent:s,do_move:t,original_event:e.original_event}});if(!n.isDefaultPrevented()){return t()}}};t.prototype.getTreeDimensions=function(){var e;e=this.tree_widget.element.offset();return{left:e.left,top:e.top,right:e.left+this.tree_widget.element.width(),bottom:e.top+this.tree_widget.element.height()+16}};return t}();y=function(){function t(e){this.tree=e}t.prototype.iterate=function(){var t,n;t=true;n=function(r){return function(i,s){var o,u,a,f,l,c,h,p;l=(i.is_open||!i.element)&&i.hasChildren();if(i.element){o=e(i.element);if(!o.is(":visible")){return}if(t){r.handleFirstNode(i,o);t=false}if(!i.hasChildren()){r.handleNode(i,s,o)}else if(i.is_open){if(!r.handleOpenFolder(i,o)){l=false}}else{r.handleClosedFolder(i,s,o)}}if(l){a=i.children.length;p=i.children;for(f=c=0,h=p.length;c<h;f=++c){u=p[f];if(f===a-1){n(i.children[f],null)}else{n(i.children[f],i.children[f+1])}}if(i.is_open){return r.handleAfterOpenFolder(i,s,o)}}}}(this);return n(this.tree,null)};t.prototype.handleNode=function(e,t,n){};t.prototype.handleOpenFolder=function(e,t){};t.prototype.handleClosedFolder=function(e,t,n){};t.prototype.handleAfterOpenFolder=function(e,t,n){};t.prototype.handleFirstNode=function(e,t){};return t}();u=function(t){function n(e,t,r){n.__super__.constructor.call(this,e);this.current_node=t;this.tree_bottom=r}C(n,t);n.prototype.generate=function(){this.positions=[];this.last_top=0;this.iterate();return this.generateHitAreas(this.positions)};n.prototype.getTop=function(e){return e.offset().top};n.prototype.addPosition=function(e,t,n){var r;r={top:n,node:e,position:t};this.positions.push(r);return this.last_top=n};n.prototype.handleNode=function(e,t,n){var r;r=this.getTop(n);if(e===this.current_node){this.addPosition(e,p.NONE,r)}else{this.addPosition(e,p.INSIDE,r)}if(t===this.current_node||e===this.current_node){return this.addPosition(e,p.NONE,r)}else{return this.addPosition(e,p.AFTER,r)}};n.prototype.handleOpenFolder=function(e,t){if(e===this.current_node){return false}if(e.children[0]!==this.current_node){this.addPosition(e,p.INSIDE,this.getTop(t))}return true};n.prototype.handleClosedFolder=function(e,t,n){var r;r=this.getTop(n);if(e===this.current_node){return this.addPosition(e,p.NONE,r)}else{this.addPosition(e,p.INSIDE,r);if(t!==this.current_node){return this.addPosition(e,p.AFTER,r)}}};n.prototype.handleFirstNode=function(t,n){if(t!==this.current_node){return this.addPosition(t,p.BEFORE,this.getTop(e(t.element)))}};n.prototype.handleAfterOpenFolder=function(e,t,n){if(e===this.current_node.node||t===this.current_node.node){return this.addPosition(e,p.NONE,this.last_top)}else{return this.addPosition(e,p.AFTER,this.last_top)}};n.prototype.generateHitAreas=function(e){var t,n,r,i,s,o;i=-1;t=[];n=[];for(s=0,o=e.length;s<o;s++){r=e[s];if(r.top!==i&&t.length){if(t.length){this.generateHitAreasForGroup(n,t,i,r.top)}i=r.top;t=[]}t.push(r)}this.generateHitAreasForGroup(n,t,i,this.tree_bottom);return n};n.prototype.generateHitAreasForGroup=function(e,t,n,r){var i,s,o,u,a;a=Math.min(t.length,4);i=Math.round((r-n)/a);s=n;o=0;while(o<a){u=t[o];e.push({top:s,bottom:s+i,node:u.node,position:u.position});s+=i;o+=1}return null};return n}(y);r=function(){function t(t,n,r,i){this.offset_x=n;this.offset_y=r;this.$element=e('<span class="jqtree-title jqtree-dragging">'+t.name+"</span>");this.$element.css("position","absolute");i.append(this.$element)}t.prototype.move=function(e,t){return this.$element.offset({left:e-this.offset_x,top:t-this.offset_y})};t.prototype.remove=function(){return this.$element.remove()};return t}();o=function(){function t(t,n,r){this.$element=n;this.node=t;this.$ghost=e('<li class="jqtree_common jqtree-ghost"><span class="jqtree_common jqtree-circle"></span><span class="jqtree_common jqtree-line"></span></li>');if(r===p.AFTER){this.moveAfter()}else if(r===p.BEFORE){this.moveBefore()}else if(r===p.INSIDE){if(t.isFolder()&&t.is_open){this.moveInsideOpenFolder()}else{this.moveInside()}}}t.prototype.remove=function(){return this.$ghost.remove()};t.prototype.moveAfter=function(){return this.$element.after(this.$ghost)};t.prototype.moveBefore=function(){return this.$element.before(this.$ghost)};t.prototype.moveInsideOpenFolder=function(){return e(this.node.children[0].element).before(this.$ghost)};t.prototype.moveInside=function(){this.$element.after(this.$ghost);return this.$ghost.addClass("jqtree-inside")};return t}();t=function(){function t(t){var n,r;n=t.children(".jqtree-element");r=t.width()-4;this.$hint=e('<span class="jqtree-border"></span>');n.append(this.$hint);this.$hint.css({width:r,height:n.height()-4})}t.prototype.remove=function(){return this.$hint.remove()};return t}();v=function(){function t(e){this.tree_widget=e;this.previous_top=-1;this._initScrollParent()}t.prototype._initScrollParent=function(){var t,n,r;n=function(t){return function(){var n,r,i,s,o,u;n=["overflow","overflow-y"];i=function(t){var r,i,s,o;for(i=0,s=n.length;i<s;i++){r=n[i];if((o=e.css(t,r))==="auto"||o==="scroll"){return true}}return false};if(i(t.tree_widget.$el[0])){return t.tree_widget.$el}u=t.tree_widget.$el.parents();for(s=0,o=u.length;s<o;s++){r=u[s];if(i(r)){return e(r)}}return null}}(this);r=function(e){return function(){e.scroll_parent_top=0;return e.$scroll_parent=null}}(this);if(this.tree_widget.$el.css("position")==="fixed"){r()}t=n();if(t&&t.length&&t[0].tagName!=="HTML"){this.$scroll_parent=t;return this.scroll_parent_top=this.$scroll_parent.offset().top}else{return r()}};t.prototype.checkScrolling=function(){var e;e=this.tree_widget.dnd_handler.hovered_area;if(e&&e.top!==this.previous_top){this.previous_top=e.top;if(this.$scroll_parent){return this._handleScrollingWithScrollParent(e)}else{return this._handleScrollingWithDocument(e)}}};t.prototype._handleScrollingWithScrollParent=function(e){var t;t=this.scroll_parent_top+this.$scroll_parent[0].offsetHeight-e.bottom;if(t<20){this.$scroll_parent[0].scrollTop+=20;this.tree_widget.refreshHitAreas();return this.previous_top=-1}else if(e.top-this.scroll_parent_top<20){this.$scroll_parent[0].scrollTop-=20;this.tree_widget.refreshHitAreas();return this.previous_top=-1}};t.prototype._handleScrollingWithDocument=function(t){var n;n=t.top-e(document).scrollTop();if(n<20){return e(document).scrollTop(e(document).scrollTop()-20)}else if(e(window).height()-(t.bottom-e(document).scrollTop())<20){return e(document).scrollTop(e(document).scrollTop()+20)}};t.prototype.scrollTo=function(t){var n;if(this.$scroll_parent){return this.$scroll_parent[0].scrollTop=t}else{n=this.tree_widget.$el.offset().top;return e(document).scrollTop(t+n)}};t.prototype.isScrolledIntoView=function(t){var n,r,i,s,o;n=e(t);if(this.$scroll_parent){o=0;s=this.$scroll_parent.height();i=n.offset().top-this.scroll_parent_top;r=i+n.height()}else{o=e(window).scrollTop();s=o+e(window).height();i=n.offset().top;r=i+n.height()}return r<=s&&i>=o};return t}();f=function(){function s(t){this.tree_widget=t;if(t.options.keyboardSupport){e(document).bind("keydown.jqtree",e.proxy(this.handleKeyDown,this))}}var t,n,r,i;n=37;i=38;r=39;t=40;s.prototype.deinit=function(){return e(document).unbind("keydown.jqtree")};s.prototype.handleKeyDown=function(s){var o,u,a,f,l,c,h;if(!this.tree_widget.options.keyboardSupport){return}if(e(document.activeElement).is("textarea,input,select")){return true}o=this.tree_widget.getSelectedNode();h=function(t){return function(n){if(n){t.tree_widget.selectNode(n);if(t.tree_widget.scroll_handler&&!t.tree_widget.scroll_handler.isScrolledIntoView(e(n.element).find(".jqtree-element"))){t.tree_widget.scrollToNode(n)}return false}else{return true}}}(this);a=function(e){return function(){return h(e.getNextNode(o))}}(this);c=function(e){return function(){return h(e.getPreviousNode(o))}}(this);l=function(e){return function(){if(o.isFolder()&&!o.is_open){e.tree_widget.openNode(o);return false}else{return true}}}(this);f=function(e){return function(){if(o.isFolder()&&o.is_open){e.tree_widget.closeNode(o);return false}else{return true}}}(this);if(!o){return true}else{u=s.which;switch(u){case t:return a();case i:return c();case r:return l();case n:return f()}}};s.prototype.getNextNode=function(e,t){var n;if(t==null){t=true}if(t&&e.hasChildren()&&e.is_open){return e.children[0]}else{if(!e.parent){return null}else{n=e.getNextSibling();if(n){return n}else{return this.getNextNode(e.parent,false)}}}};s.prototype.getPreviousNode=function(e){var t;if(!e.parent){return null}else{t=e.getPreviousSibling();if(t){if(!t.hasChildren()||!t.is_open){return t}else{return this.getLastChild(t)}}else{if(e.parent.parent){return e.parent}else{return null}}}};s.prototype.getLastChild=function(e){var t;if(!e.hasChildren()){return null}else{t=e.children[e.children.length-1];if(!t.hasChildren()||!t.is_open){return t}else{return this.getLastChild(t)}}};return s}()}).call(this)
